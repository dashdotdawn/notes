<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络 | _.dawn</title>
    <meta name="description" content="新闻发布署">
    
    
    <link rel="preload" href="/notes/assets/css/0.styles.9c1a28d7.css" as="style"><link rel="preload" href="/notes/assets/js/app.7fb44869.js" as="script"><link rel="preload" href="/notes/assets/js/11.9b69c166.js" as="script"><link rel="prefetch" href="/notes/assets/js/15.0c721535.js"><link rel="prefetch" href="/notes/assets/js/2.9a15e329.js"><link rel="prefetch" href="/notes/assets/js/3.4efdfa39.js"><link rel="prefetch" href="/notes/assets/js/4.675a765e.js"><link rel="prefetch" href="/notes/assets/js/5.db1e46a4.js"><link rel="prefetch" href="/notes/assets/js/6.04ddd226.js"><link rel="prefetch" href="/notes/assets/js/7.7ae72a82.js"><link rel="prefetch" href="/notes/assets/js/8.4cdc1d80.js"><link rel="prefetch" href="/notes/assets/js/9.95701596.js"><link rel="prefetch" href="/notes/assets/js/10.0a4a605e.js"><link rel="prefetch" href="/notes/assets/js/12.5f93cb25.js"><link rel="prefetch" href="/notes/assets/js/13.6e1c22e7.js"><link rel="prefetch" href="/notes/assets/js/14.b76bb14a.js"><link rel="prefetch" href="/notes/assets/js/16.118cf163.js"><link rel="prefetch" href="/notes/assets/js/17.d79e9bae.js"><link rel="prefetch" href="/notes/assets/js/18.621aab7a.js"><link rel="prefetch" href="/notes/assets/js/19.1bf38dd6.js"><link rel="prefetch" href="/notes/assets/js/20.3cd2c8c9.js"><link rel="prefetch" href="/notes/assets/js/21.d3c4697f.js"><link rel="prefetch" href="/notes/assets/js/22.2af2c9f4.js"><link rel="prefetch" href="/notes/assets/js/23.49b1fcd8.js"><link rel="prefetch" href="/notes/assets/js/24.e86d0b15.js"><link rel="prefetch" href="/notes/assets/js/25.85627c9c.js"><link rel="prefetch" href="/notes/assets/js/26.fde3b38f.js"><link rel="prefetch" href="/notes/assets/js/27.fbf19f8c.js"><link rel="prefetch" href="/notes/assets/js/28.0a9b6c96.js"><link rel="prefetch" href="/notes/assets/js/29.6cc87f08.js"><link rel="prefetch" href="/notes/assets/js/30.7bfe4d10.js"><link rel="prefetch" href="/notes/assets/js/31.50c13991.js"><link rel="prefetch" href="/notes/assets/js/32.a11d06ec.js"><link rel="prefetch" href="/notes/assets/js/33.c59f1385.js"><link rel="prefetch" href="/notes/assets/js/34.a8759261.js"><link rel="prefetch" href="/notes/assets/js/35.8e758eb9.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.9c1a28d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">_.dawn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>网络</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/notes/category/http.html#互联网协议" class="sidebar-link">互联网协议</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/category/http.html#tcp-udp" class="sidebar-link">TCP / UDP</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/category/http.html#http" class="sidebar-link">HTTP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/category/http.html#一些定义" class="sidebar-link">一些定义</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#http-报文组成" class="sidebar-link">HTTP 报文组成</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#http-方法" class="sidebar-link">HTTP 方法</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#状态码" class="sidebar-link">状态码</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#首部" class="sidebar-link">首部</a></li></ul></li><li><a href="/notes/category/http.html#http-缓存" class="sidebar-link">HTTP 缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/category/http.html#一些概念" class="sidebar-link">一些概念</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#cache-control" class="sidebar-link">Cache-Control</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#tips" class="sidebar-link">tips</a></li><li class="sidebar-sub-header"><a href="/notes/category/http.html#缓存策略" class="sidebar-link">缓存策略</a></li></ul></li><li><a href="/notes/category/http.html#todo" class="sidebar-link">TODO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/category/http.html#localstorage-sessionstorage-cookie" class="sidebar-link">localStorage sessionStorage cookie</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="网络"><a href="#网络" aria-hidden="true" class="header-anchor">#</a> 网络</h1> <blockquote><p>网络相关很弱..</p></blockquote> <h2 id="互联网协议"><a href="#互联网协议" aria-hidden="true" class="header-anchor">#</a> 互联网协议</h2> <ol><li>application layer
<ul><li>DHCP 协议(建立在 UDP 上)：用来获取本机 IP、网关 IP、DNS IP、子网掩码</li> <li>发出 port 68 -&gt; 67; IP 0.0.0.0 -&gt; 255.255.255.255</li> <li>DHCP 服务器返回 67 -&gt;68: IP -&gt; 255.255.255.255 Data: 子网掩码 DNS IP 分配 IP</li> <li>HTTP</li></ul></li> <li>transport：port (port + host = socket)
<ul><li>TCP 慢启动 ACK (期待 seq / 剩余容量）</li></ul></li> <li>network
<ul><li>IP 协议（网络部分+主机部分，分配 IP 子网掩码用来判断是否属于同一子网）</li> <li>ARP 协议（同一子网可以根据 IP 查询 Mac 地址）</li></ul></li> <li>link：确定分组方式，一组为一帧（HEAD+DATA)，在子网内广播，使用 MAC 地址判断接收方</li> <li>physical： 物理连接 传输 0 1 电信号</li></ol> <p>以太网数据包，数据部分大小为 1500 bytes</p> <table><thead><tr><th>以太网HEAD</th> <th>IP</th> <th>TCP</th> <th>DATA</th></tr></thead> <tbody><tr><td>22</td> <td>20+</td> <td>20+</td> <td>&lt;1460</td></tr></tbody></table> <p><a href="http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html" target="_blank" rel="noopener noreferrer">互联网协议入门（一） - 阮一峰的网络日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="tcp-udp"><a href="#tcp-udp" aria-hidden="true" class="header-anchor">#</a> TCP / UDP</h2> <blockquote><p>这块儿理解略粗浅，买的书还没来得及看</p></blockquote> <p><code>三次握手</code>：建立一个 TCP 连接，需要客户端和服务器一共发送 3 个包</p> <ol><li>SYN = 1, seq = x; 客户端发送后进入 SYN_SEND</li> <li>SYN = 1, ACK = 1, seq = y, ACKnum = x + 1; 服务端发回后进入 SYN_RCVD</li> <li>SYN = 0, ACK = 1, ACKnum = y + 1; 客户端发送后进入 EASTABLISHED，服务端接收后也为 ESTABLISHED</li></ol> <p>A: 嗨我有话和你说，能听到吗收到回复</p> <p>B: 回复：我能听到，我说的你能听到吗收到回复</p> <p>A: 回复：我也能听到</p> <p><code>四次挥手</code>：TCP 连接的拆除，任何一方都可以发起 close，以客户端发起为例</p> <ol><li>FIN = 1, seq = x; 客户端发送后进入 FIN_WAIT_1</li> <li>ACK = 1, ACKnum = x + 1; 服务器发送后进入 CLOSE_WATI, 客户端收到后进入 FIN_WATI_2</li> <li>FIN = 1, seq = y; 服务器发送后进入 LAST_ACK</li> <li>ACK = 1, ACKnum = y + 1; 客户端发送后，进入 TIME_WAIT，等待可能出现要求重传的 ACK; 服务器收到后关闭连接，进入 CLOSED; 客户端等待两个最大段生命周期后，未收到 ACK，则关闭连接，进入 CLOSED</li></ol> <p>A: 我要关啦</p> <p>B: 好的我知道了你等我一下</p> <p>A: 好了我要关了，收到告诉我不然我烦死你</p> <p>B: 好的我收到了，过会你不出声我就当你收到了</p> <p><a href="https://hit-alibaba.github.io/interview/basic/network/TCP.html" target="_blank" rel="noopener noreferrer">TCP 协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>UDP vs TCP</p> <ul><li>UDP 支持广播和多播</li> <li>UDP 是无连接的</li> <li>UDP 缺乏可靠性，不保证数据到达、到达次数、不能确认数据顺序</li> <li>UDP 头部 8 字节 / TCP 20 字节</li></ul> <h2 id="http"><a href="#http" aria-hidden="true" class="header-anchor">#</a> HTTP</h2> <h3 id="一些定义"><a href="#一些定义" aria-hidden="true" class="header-anchor">#</a> 一些定义</h3> <p>结构组件</p> <ul><li>proxy 位于客户端和服务器之间的 HTTP 中间实体</li> <li>cache</li> <li>gateway</li> <li>tunnel 盲转发</li> <li>agent 代表用户发起 HTTP 请求的客户端程序：浏览器 / 搜索引擎 spider</li></ul> <p>URI 和 URL</p> <ul><li>URI 统一资源标识符：包括 URL(统一资源定位符) 和 URN（统一资源名）</li> <li>URL: scheme://服务器位置/路径</li> <li>转义：% + 字符 ASCII 码的十六进制数</li> <li>保留和受限字符：如 % 等</li></ul> <h3 id="http-报文组成"><a href="#http-报文组成" aria-hidden="true" class="header-anchor">#</a> HTTP 报文组成</h3> <ul><li>起始行</li> <li>首部</li> <li>主体</li></ul> <p>起始行和首部分隔：行终止序列（CRLF: /r/n, 回车 + 换行)</p> <h3 id="http-方法"><a href="#http-方法" aria-hidden="true" class="header-anchor">#</a> HTTP 方法</h3> <p>GET PUT HEAD POST DELETE TRACE OPTIONS</p> <h3 id="状态码"><a href="#状态码" aria-hidden="true" class="header-anchor">#</a> 状态码</h3> <p>1XX: 信息性</p> <ul><li>100 continue 继续请求，用来回应 Expect: 100 Continue 的请求</li></ul> <p>2XX: 成功</p> <ul><li>200 OK 请求成功</li> <li>204 no content 请求成功，不返回实体内容</li> <li>205 reset content 请求成功，不返回实体内容，要求请求者重置文档视图</li> <li>206 partial content 请求成功，主体包含请求的范围区间，（回应 Range)，可用来断点续传</li></ul> <p>3XX: 重定向</p> <ul><li>301 moved permanently 永久重定向，返回 location</li> <li>302 found 临时重定向，一些旧的用户代理可能将请求转为 get</li> <li>303 see other 响应在另一个 url 上，应采用 get 访问</li> <li>304 not modified(回应带条件的 get 请求，如 if modified since)</li> <li>307 temporary redirect 确保请求方法和消息主体不变</li></ul> <p>4XX: 客户端错误</p> <ul><li>400 bad request 语义有误，参数有误</li> <li>401 unauthorized 需用户验证</li> <li>403 forbidden 拒绝执行</li> <li>404 not found 没有找到请求的资源</li></ul> <p>5XX: 服务器错误</p> <ul><li>500 internal server error 服务器错误，遇到意外被阻止了执行</li> <li>501 not implemented 服务器不支持请求方法（GET HEAD 必须支持）</li> <li>503 service unavailable 服务器没有准备好处理请求，如停机维护、超载</li></ul> <h3 id="首部"><a href="#首部" aria-hidden="true" class="header-anchor">#</a> 首部</h3> <p><code>incomplete</code></p> <table><thead><tr><th>general header</th> <th>定义</th></tr></thead> <tbody><tr><td>Date</td> <td>消息生成时间 GMT</td></tr> <tr><td>Cache-Control</td> <td></td></tr> <tr><td>Connection</td> <td>keep-alive / close</td></tr> <tr><td>Pragma</td> <td></td></tr></tbody></table> <table><thead><tr><th>request header</th> <th>定义</th></tr></thead> <tbody><tr><td>Accept</td> <td>用户代理期望的MIME 类型列表</td></tr> <tr><td>Accept-Charset</td> <td>列出用户代理支持的字符集</td></tr> <tr><td>Accept-Language</td> <td>列出用户代理期望的页面语言</td></tr> <tr><td>Accept-Encoding</td> <td>列出用户代支持的压缩方法</td></tr> <tr><td>Expect</td> <td></td></tr> <tr><td>Range</td> <td></td></tr> <tr><td>Referer</td> <td></td></tr> <tr><td>Host</td> <td></td></tr> <tr><td>User-Agent</td> <td></td></tr> <tr><td>If-Match</td> <td></td></tr> <tr><td>Authorization</td> <td></td></tr></tbody></table> <table><thead><tr><th>response header</th> <th>定义</th></tr></thead> <tbody><tr><td>Age</td> <td></td></tr> <tr><td>ETag</td> <td></td></tr> <tr><td>Location</td> <td></td></tr></tbody></table> <table><thead><tr><th>entity header</th> <th>定义</th></tr></thead> <tbody><tr><td>Allow</td> <td></td></tr> <tr><td>Content-Lenght</td> <td></td></tr> <tr><td>Expires</td> <td></td></tr> <tr><td>Last Modified</td> <td></td></tr> <tr><td>Content-Type</td> <td>指示服务器文档的MIME 类型</td></tr> <tr><td>Content-Length</td> <td></td></tr></tbody></table> <h2 id="http-缓存"><a href="#http-缓存" aria-hidden="true" class="header-anchor">#</a> HTTP 缓存</h2> <h3 id="一些概念"><a href="#一些概念" aria-hidden="true" class="header-anchor">#</a> 一些概念</h3> <p>相关首部：Pragma | Cache-Control | Expires | ETag | Last-Modified | If-None-Match | Last-Modified-Since</p> <p>优先级: Pragma &gt; Cache-Control &gt; Expires; ETag &gt; Last-Modified</p> <p>缓存目标：一般只缓存 GET 请求</p> <p>分类：强缓存、协商缓存 / 私有缓存、共享缓存</p> <p>缓存命中过程：</p> <ol><li>本地判断强缓存（expires / cache-control)，命中则直接使用</li> <li>强缓存未命中时，发出 HTTP 请求，判断协商缓存(etag / last-modified)</li> <li>304 表示命中则直接使用，200 表示未命中则更新缓存</li></ol> <h3 id="cache-control"><a href="#cache-control" aria-hidden="true" class="header-anchor">#</a> Cache-Control</h3> <table><thead><tr><th>response directive</th> <th>request directive</th></tr></thead> <tbody><tr><td>no-cache</td> <td>no-cache</td></tr> <tr><td>no-store</td> <td>no-store</td></tr> <tr><td>no-transform</td> <td>no-transform</td></tr> <tr><td>max-age=&lt; seconds&gt;</td> <td>max-age=&lt;seconds&gt;</td></tr> <tr><td>s-maxage=&lt;seconds&gt;</td> <td>max-stale[=&lt;seconds&gt;]</td></tr> <tr><td>proxy-revalidate</td> <td>min-fresh=&lt;seconds&gt;</td></tr> <tr><td>must-revalidate</td> <td>only-if-cached</td></tr> <tr><td>public</td> <td></td></tr> <tr><td>private</td> <td></td></tr></tbody></table> <ul><li>Cache-Control: no-store 禁止缓存</li> <li>Cache-Control: no-cache 强制向源服务器确认缓存(max-age=0)</li> <li>Cache-Control: must-revalidate 过期后，进行缓存验证</li> <li>Cache-Control: private 中间人不能缓存此响应，该响应只能应用于浏览器私有缓存</li> <li>Cache-Control: public 中间人可以缓存此响应</li> <li>Cache-Control: max-age=31536000 资源能够被缓存的最大时间，距离请求发起的时间的秒数</li> <li>Cache-Control: s-maxage=31536000 仅应用于共享缓存，优先级最高</li></ul> <h3 id="tips"><a href="#tips" aria-hidden="true" class="header-anchor">#</a> tips</h3> <p>用户操作对缓存的影响</p> <ul><li>首次访问，得到响应 200，得到 ETag / Last-Modified</li> <li>二次访问
<ol><li>输入地址回车：判断本地缓存，命中则直接访问，不重新发起 HTTP 请求，否则触发缓存验证</li> <li>普通刷新(cmd + r)：触发缓存验证，发送 cache-control: max-age=0 / if-modified-since / if-none-match，得到 304 / 200</li> <li>强制刷新(cmd + shif + r 或 devtool 中勾选 disable cache 的情况下普通刷新)：发送 cache-control: no-cache，得到 200</li></ol></li></ul> <p>区分</p> <ul><li>max-age=0 vs expires: expires 是绝对时间，根据浏览器时间判断，兼容 HTTP/1.0；max-age 是时间间隔，根据 date 判断，优先级更高</li> <li>max-age=0 vs no-cache: <code>[incomplete]</code></li> <li>must-revalidate vs no-cache: must-revalidate 在过期后才进行缓存验证</li> <li>ETag vs Last-Modified
<ol><li>Last-Modified 只精确到秒，文件内容不变时间改变时无法命中</li> <li>ETag 是一种文件指纹</li> <li>ETag 更消耗服务端资源</li></ol></li></ul> <h3 id="缓存策略"><a href="#缓存策略" aria-hidden="true" class="header-anchor">#</a> 缓存策略</h3> <ol><li>HTML 文件，不缓存 no-cache</li> <li>可缓存资源，需配合使用强缓存和协商缓存</li> <li>强缓存：使用 Expires 兼容 HTTP/1.0，同时使用Cache-Control</li> <li>协商缓存：没有特殊需求优先使用 last-modified，无法满足则使用 etag</li> <li>在文件名中标识版本号，长期缓存 max-age=31536000，以减少 304 响应</li></ol> <ul><li><a href="http://www.cnblogs.com/chyingp/p/no-cache-vs-must-revalidate.html" target="_blank" rel="noopener noreferrer">web性能优化之：no-cache与must-revalidate深入探究<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9" target="_blank" rel="noopener noreferrer">HTTP_1.1_ Header Field Definitions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="todo"><a href="#todo" aria-hidden="true" class="header-anchor">#</a> TODO</h2> <p>preload
prefetch</p> <h3 id="localstorage-sessionstorage-cookie"><a href="#localstorage-sessionstorage-cookie" aria-hidden="true" class="header-anchor">#</a> localStorage sessionStorage cookie</h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/notes/assets/js/11.9b69c166.js" defer></script><script src="/notes/assets/js/app.7fb44869.js" defer></script>
  </body>
</html>
