<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodejs 初体验 | _.dawn</title>
    <meta name="description" content="新闻发布署">
    
    
    <link rel="preload" href="/notes/assets/css/0.styles.9c1a28d7.css" as="style"><link rel="preload" href="/notes/assets/js/app.7fb44869.js" as="script"><link rel="preload" href="/notes/assets/js/17.d79e9bae.js" as="script"><link rel="prefetch" href="/notes/assets/js/15.0c721535.js"><link rel="prefetch" href="/notes/assets/js/2.9a15e329.js"><link rel="prefetch" href="/notes/assets/js/3.4efdfa39.js"><link rel="prefetch" href="/notes/assets/js/4.675a765e.js"><link rel="prefetch" href="/notes/assets/js/5.db1e46a4.js"><link rel="prefetch" href="/notes/assets/js/6.04ddd226.js"><link rel="prefetch" href="/notes/assets/js/7.7ae72a82.js"><link rel="prefetch" href="/notes/assets/js/8.4cdc1d80.js"><link rel="prefetch" href="/notes/assets/js/9.95701596.js"><link rel="prefetch" href="/notes/assets/js/10.0a4a605e.js"><link rel="prefetch" href="/notes/assets/js/11.9b69c166.js"><link rel="prefetch" href="/notes/assets/js/12.5f93cb25.js"><link rel="prefetch" href="/notes/assets/js/13.6e1c22e7.js"><link rel="prefetch" href="/notes/assets/js/14.b76bb14a.js"><link rel="prefetch" href="/notes/assets/js/16.118cf163.js"><link rel="prefetch" href="/notes/assets/js/18.621aab7a.js"><link rel="prefetch" href="/notes/assets/js/19.1bf38dd6.js"><link rel="prefetch" href="/notes/assets/js/20.3cd2c8c9.js"><link rel="prefetch" href="/notes/assets/js/21.d3c4697f.js"><link rel="prefetch" href="/notes/assets/js/22.2af2c9f4.js"><link rel="prefetch" href="/notes/assets/js/23.49b1fcd8.js"><link rel="prefetch" href="/notes/assets/js/24.e86d0b15.js"><link rel="prefetch" href="/notes/assets/js/25.85627c9c.js"><link rel="prefetch" href="/notes/assets/js/26.fde3b38f.js"><link rel="prefetch" href="/notes/assets/js/27.fbf19f8c.js"><link rel="prefetch" href="/notes/assets/js/28.0a9b6c96.js"><link rel="prefetch" href="/notes/assets/js/29.6cc87f08.js"><link rel="prefetch" href="/notes/assets/js/30.7bfe4d10.js"><link rel="prefetch" href="/notes/assets/js/31.50c13991.js"><link rel="prefetch" href="/notes/assets/js/32.a11d06ec.js"><link rel="prefetch" href="/notes/assets/js/33.c59f1385.js"><link rel="prefetch" href="/notes/assets/js/34.a8759261.js"><link rel="prefetch" href="/notes/assets/js/35.8e758eb9.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.9c1a28d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">_.dawn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>nodejs 初体验</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/notes/category/node.html#node-lessons-学习记录" class="sidebar-link">node-lessons 学习记录</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/category/node.html#todo" class="sidebar-link">TODO</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="nodejs-初体验"><a href="#nodejs-初体验" aria-hidden="true" class="header-anchor">#</a> nodejs 初体验</h1> <blockquote><p>前端工程化是无法避开 nodejs 的</p></blockquote> <h2 id="node-lessons-学习记录"><a href="#node-lessons-学习记录" aria-hidden="true" class="header-anchor">#</a> <a href="https://github.com/alsotang/node-lessons" target="_blank" rel="noopener noreferrer">node-lessons<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 学习记录</h2> <p>新手向的实践教程，使我对 nodejs 可以做什么有了初步认识，感谢作者。</p> <ul><li>express 作为 http 服务器，监听端口，生成响应</li> <li>superagent 抓取网页 .get().then()</li> <li>cheerio 分析网页元素</li> <li>eventproxy 事件处理 api，可以用 emit 和 after 来模拟 promise.all 的行为</li> <li>async async.mapLimit 可以用来来控制并发数</li> <li>mocha 测试框架；should / chai 断言库；istanbul 测试覆盖率<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../xx/module'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> should <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'should'</span><span class="token punctuation">)</span>
 
<span class="token comment">// test/module.test.js 测试脚本</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'描述一组测试功能'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'描述测试用例'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
module<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span>

<span class="token comment">// package.json</span>
scripts<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token string">&quot;test&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;mocha&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;test:cov&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;istanbul cover _mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>mocha 前端环境下测试
<ul><li><code>mocha init directory</code> 生成前端测试环境文件</li> <li><code>mocha-chrome index.html</code> 在命令行下进行前端脚步测试 <a href="https://github.com/shellscape/mocha-chrome" target="_blank" rel="noopener noreferrer">mocha-chrome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></li> <li>nodemon 监控 nodejs 文件变化，自动重启应用</li> <li>supertest 配合 express 等 web 框架进行集成测试</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// module.test.js</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../app'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> supertest <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'supertest'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">supertest</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    request
      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">FIB_URL</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>n<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>expect<span class="token punctuation">)</span>
        <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>正则表达式
见 <a href="/notes/category/regexp.html">正则表达式 常忘常记</a></li> <li>benchmark 测试性能</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Benchmark <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'benchmark'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> suite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Benchmark<span class="token punctuation">.</span>Suite</span>
suite
  <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>'test xxx<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'test yyy'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 每跑完一个测试</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'cycle'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 完成测试</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'complete'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Fastest is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'fastest'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'async'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>mongodb, mongoose</p> <p>mongodb 是 document database，记录类型为 BSON documents，是 JSON 的超集，可以存储二进制文件，表现为 fiels: value，value 可以是任意 BSON 值。</p> <p>层级结构：database -&gt; collection -&gt; document。</p> <ol><li>安装 mongodb <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/#install-mongodb-community-edition" target="_blank" rel="noopener noreferrer">install-mongodb-on-os-x<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>brew <span class="token function">install</span> mongodb
</code></pre></div><ol start="2"><li>启动</li></ol> <ul><li>mkdir -p /data/db</li> <li>chown `id -u` /data/db: 需要读写权限，`id -u` 会返回 uid</li> <li>mongod</li></ul> <p>或者</p> <ul><li><ol><li>mongod --dbpath &lt;path to data directory&gt; 指定一个目录</li></ol></li></ul> <ol start="3"><li>连接并进行操作
<a href="https://docs.mongodb.com/manual/reference/method/" target="_blank" rel="noopener noreferrer">mongo shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>ᐅ mongo // 连接至 mongodb
MongoDB shell version v4.0.1
connecting to: mongodb://127.0.0.1:27017
MongoDB server version: 4.0.1
<span class="token operator">&gt;</span> show dbs // 显示所有 database，不包括当前空 database 
admin   0.000GB
config  0.000GB
local   0.000GB
ttt     0.000GB
<span class="token operator">&gt;</span> db // 显示当前 database 默认为 <span class="token function">test</span>
<span class="token function">test</span>
<span class="token operator">&gt;</span> use ttt // 切换 database，允许切换至不存在的 database
switched to db ttt
<span class="token operator">&gt;</span> db.newCollection.insertOne<span class="token punctuation">(</span><span class="token punctuation">{</span>x:1<span class="token punctuation">}</span><span class="token punctuation">)</span> // 插入记录
<span class="token punctuation">{</span>
  <span class="token string">&quot;acknowledged&quot;</span> <span class="token keyword">:</span> true,
  <span class="token string">&quot;insertedId&quot;</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5b8c153c4608eb940b8b918d&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> db.getCollection<span class="token punctuation">(</span><span class="token string">'newCollection'</span><span class="token punctuation">)</span>.find<span class="token punctuation">(</span><span class="token punctuation">)</span> // 读取记录
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5b8c153c4608eb940b8b918d&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;x&quot;</span> <span class="token keyword">:</span> 1 <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span> // 删除当前 db
<span class="token operator">&gt;</span> quit<span class="token punctuation">(</span><span class="token punctuation">)</span> // 退出
</code></pre></div><p>显然这种操作过于繁琐，而 mongoose 可以将调用方法转换成 mongodb shell 与数据库进行交互。<a href="https://mongoosejs.com/docs/index.html" target="_blank" rel="noopener noreferrer">mongoose docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>下面是官网的一个简单例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/test'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>connection

db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span>error<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">'connection error:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success open'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建模式，数据格式集合</span>
<span class="token keyword">var</span> catSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  friends<span class="token punctuation">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// method 需在 model compile 之前定义</span>
catSchema<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function-variable function">speak</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> greetings <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token operator">?</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is meow meow`</span></span>
    <span class="token punctuation">:</span> <span class="token string">'I have no name'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greetings<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 根据 schema 编译 model，model 用来构造 documents，这里默认会将 Kitten.toLowerCase() + 's' 作为 collection 的名字</span>
<span class="token keyword">var</span> Kitten <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Kitten'</span><span class="token punctuation">,</span> catSchema<span class="token punctuation">)</span>

<span class="token comment">// 新建 document</span>
<span class="token keyword">var</span> mimi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Kitten</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'mimi'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// mimi.speak()</span>

<span class="token comment">// 存入一条记录</span>
mimi<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> mimi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  mimi<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Kitten<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token regex">/m/</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'--------------------'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'--------------------'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>node index.js</code> 运行上述文件后，在 mongo 中验证一下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> db
<span class="token function">test</span>
<span class="token operator">&gt;</span> show collections
kittens
<span class="token operator">&gt;</span> db.kittens.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5b8c1deaa7635199b7897417&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;friends&quot;</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>, <span class="token string">&quot;name&quot;</span> <span class="token keyword">:</span> <span class="token string">&quot;mimi&quot;</span>, <span class="token string">&quot;__v&quot;</span> <span class="token keyword">:</span> 0 <span class="token punctuation">}</span>
</code></pre></div><p>验证成功。</p></li></ul> <h2 id="todo"><a href="#todo" aria-hidden="true" class="header-anchor">#</a> TODO</h2> <ul><li>events</li> <li>http</li> <li>stream</li> <li>fs</li> <li>crypto</li> <li>中间件</li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/notes/assets/js/17.d79e9bae.js" defer></script><script src="/notes/assets/js/app.7fb44869.js" defer></script>
  </body>
</html>
